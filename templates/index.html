<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pickleball League App</title>
    <meta name="author" content="Guilherme Chapiewski">
    <meta name="description" content="Create your own Pickleball League in seconds! üèì">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="//img1.wsimg.com/isteam/ip/static/pwa-app/logo-default.png/:/rs=w:180,h:180,m">
    
    <!-- Social Meta Tags -->
    <meta property="og:title" content="Pickleball League App">
    <meta property="og:description" content="Create your own Pickleball League in seconds! üèì">
    <meta property="og:image" content="https://img1.wsimg.com/isteam/getty/1517470401">
    <meta property="og:url" content="https://pickleballleague.app/">
    <meta name="twitter:card" content="summary">

    <meta name="google-signin-client_id" content="873677737409-pkh5rfq6ejpr8dieqalnshjk09tfo9f0.apps.googleusercontent.com">

    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            background: #000;
            color: #fff;
        }

        .hero {
            min-height: 65vh;
            background-image: linear-gradient(rgba(0,0,0,0.25), rgba(0,0,0,0.25)), url("//img1.wsimg.com/isteam/getty/1517470401");
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px 20px;
        }

        @media (min-height: 800px) {
            .hero {
                min-height: 35vh;
            }
        }
        
        @media (max-width: 768px) {
            .hero {
                min-height: 30vh;
            }
        }

        .hero h1 {
            font-size: 36px;
            margin: 0;
            font-family: sans-serif;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            text-align: center;
        }

        form {
            max-width: 500px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        input[type="text"], select {
            width: 98%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background: #fff;
            color: #000;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        .version {
            font-size: 12px;
            color: #fff;
            opacity: 0.7;
            margin-top: 20px;
        }

        .version a {
            color: #fff;
        }
        
        .g_id_signin {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        .loggedin-user-info {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 101;
            font-size: 12px;
            color: #ffffff;
            opacity: 1;
            background-color: #ca0363;
            padding: 10px 10px;
            border-radius: 4px;
            max-width: 220px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: none;
        }

        .loggedin-user-email {
            font-weight: bold;
            text-overflow: ellipsis;
            font-size: 10px;
        }

        .loggedin-user-account a {
            color: #fff;
            text-decoration: none;
        }

        .loggedin-user-account a:hover {
            text-decoration: underline;
        }
    </style>
    <script language="javascript" type="text/javascript">
        var validateForm = function() {
            var playerNames = document.getElementById('player_names').value;
            var players = playerNames.split(',').filter(name => name.trim().length > 0);
            if (players.length < 4) {
                alert('You need at least 4 players to create a league.');
                return false;
            }
            // Check if the selected rounds are valid for the number of players
            var rounds = parseInt(document.getElementById('rounds').value);
            if (rounds >= 5 && rounds <= 6 && players.length < 5) {
                alert('You need at least 5 players for '+rounds+' rounds.');
                return false;
            }
            if (rounds >= 7 && players.length < 6) {
                alert('You need at least 6 players for '+rounds+' rounds.');
                return false;
            }
            return true;
        }

        {% if dev_environment %}
        var handleCredentialResponseDEV = function() {
            const devUserEmail = "gc@pickleballleague.app";
            const devUserId = "1234567890";
            
            console.log("Google Account ID (DEV): " + devUserId);
            document.getElementById('loggedin-user-email').innerHTML = devUserEmail;
            document.getElementsByClassName('loggedin-user-info')[0].style.display = 'block';
            
            const expirationDate = new Date();
            expirationDate.setDate(expirationDate.getDate() + 1);
            document.cookie = `userEmail=${devUserEmail}; expires=${expirationDate.toUTCString()}; path=/`;
            document.cookie = `userId=${devUserId}; expires=${expirationDate.toUTCString()}; path=/`;
            console.log("DEV User login information saved to cookies");
        }
        {% else %}
        var handleCredentialResponse = function(response) {
            const responsePayload = decodeJwtResponse(response.credential);
            const userEmail = responsePayload.email;
            const userId = responsePayload.sub;

            console.log("Google Account ID: " + userId);
            document.getElementById('loggedin-user-email').innerHTML = userEmail;
            document.getElementsByClassName('loggedin-user-info')[0].style.display = 'block';
            
            // Save user info in a cookie for 30 days
            const expirationDate = new Date();
            expirationDate.setDate(expirationDate.getDate() + 30);
            document.cookie = `userEmail=${userEmail}; expires=${expirationDate.toUTCString()}; path=/`;
            document.cookie = `userId=${userId}; expires=${expirationDate.toUTCString()}; path=/`;
            console.log("User login information saved to cookies");
        }
        {% endif %}

        var decodeJwtResponse = function(token) {
            let base64Url = token.split('.')[1];
            let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            let jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        var getUserInfoFromCookies = function() {
            const cookies = document.cookie.split('; ');
            const userEmailCookie = cookies.find(row => row.startsWith('userEmail='));
            const userIdCookie = cookies.find(row => row.startsWith('userId='));
            
            if (userEmailCookie && userIdCookie) {
                const userEmail = userEmailCookie.split('=')[1];
                const userId = userIdCookie.split('=')[1];
                return { userEmail, userId };
            }
            return null;
        }

        var signOut = function() {
            document.cookie = "userEmail=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            document.cookie = "userId=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            document.getElementsByClassName('loggedin-user-info')[0].style.display = 'none';
            document.getElementById('loggedin-user-email').innerHTML = '';
        }
        
        window.onload = function() {
            const userInfo = getUserInfoFromCookies();
            if (userInfo) {
                document.getElementById('loggedin-user-email').innerHTML = userInfo.userEmail;
                document.getElementsByClassName('loggedin-user-info')[0].style.display = 'block';
                console.log("User login information loaded from cookies");
            }
        }
    </script>
</head>

<body>
    <div class="loggedin-user-info"><span class="loggedin-user-account"><a href="/profile">Profile</a></span> | <span class="loggedin-user-account"><a href="#" onclick="signOut()">Sign out</a></span> | <span id="loggedin-user-email" class="loggedin-user-email">@</span></div>
    {% if dev_environment %}
    <div class="g_id_signin"
        data-type="standard"
        data-shape="pill"
        data-theme="outline"
        data-text="signin"
        data-size="medium"
        data-logo_alignment="left">
        <button onclick="handleCredentialResponseDEV()" style="height: 30px; padding: 6px;">Sign in (DEV ENV)</button>
    </div>
    {% else %}
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <div id="g_id_onload"
        data-client_id="873677737409-pkh5rfq6ejpr8dieqalnshjk09tfo9f0.apps.googleusercontent.com"
        data-context="use"
        data-ux_mode="popup"
        data-callback="handleCredentialResponse"
        data-auto_select="true"
        data-itp_support="true">
    </div>

    <div class="g_id_signin"
        data-type="standard"
        data-shape="pill"
        data-theme="outline"
        data-text="signin"
        data-size="medium"
        data-logo_alignment="left">
    </div>
    {% endif %}
    <div class="hero">
        <h1>Create your own Pickleball league in seconds! üèì</h1>
    </div>
    <div class="container">
        <form method="POST" action="/create-league" onsubmit="return validateForm()">
            <table style="width: 100%; padding: 0 0 20px;" cellspacing="0" cellpadding="5">
                <tr>
                    <td style="text-align: right; width: 10%;">Players:</td>
                    <td><input type="text" id="player_names" name="player_names" placeholder="Player names separated by comma"></td>
                </tr>
                <tr>
                    <td style="text-align: right;">League name:</td>
                    <td><input type="text" name="league_name" placeholder="League name (optional)"></td>
                </tr>
                <tr>
                    <td style="text-align: right;">Scoring system:</td>
                    <td>
                        <select name="scoring_system">
                            <option value="none">None (good for printing)</option>
                            <option value="w_l">W/L (track wins and losses only)</option>
                            <option value="score">Score (track full score)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right;">Rounds:</td>
                    <td>
                        <select name="rounds" id="rounds">
                            <option value="0">Default (based on number of players)</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (5+ players required)</option>
                            <option value="6">6 (5+ players required)</option>
                            <option value="7">7 (6+ players required)</option>
                            <option value="8">8 (6+ players required)</option>
                            <option value="9">9 (6+ players required)</option>
                            <option value="10">10 (6+ players required)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right;">Template:</td>
                    <td style="text-align: right;">
                        <select name="template" id="template">
                            <option value="ricky">Ricky (default)</option>
                            <option value="irina-fariba">Irina/Fariba</option>
                        </select>
                    </td>
                </tr>
            </table>
            <button type="submit">Create league</button>
        </form>
        <br>
        <div class="version">
            <i>Open Sourced under <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons BY-NC 4.0 license</a> | version <a href="https://github.com/guilhermechapiewski/pickleballleague.app/commit/{{version.git_commit}}">{{version.git_commit}}</a> | updated {{version.deploy_timestamp}}</i>
        </div>
    </div>
</body>
</html>