<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pickleball League App{% if league.name %} - {{ league.name }}{% endif %}</title>
    <style>
        body {
            font-family: sans-serif;
            color: #333;
            padding: 10px;
            background-color: #f9f9f9;
        }
        
        h1 {
            color: #2c3e50;
            text-align: left;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        p {
            font-size: 12px;
        }

        .small-button {
            font-size: 12px;
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }

        #edit-players {
            border: 1px solid #ffffff;
        }

        #edit-save-players, #edit-cancel-players {
            visibility: hidden;
            border: 1px solid #ffffff;
        }

        .small-button:hover {
            background-color: #1a2530;
        }

        .small-button:active {
            background-color: #00881e;
        }

        .link-container {
            display: flex;
            align-items: center;
            gap: 4px;
            width: 100%; 
            overflow-x: auto;
        }

        .link-show-container {
            font-size: 12px;
            display: block;
            max-width: 500px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .name-show-container {
            display: block;
            align-items: center;
        }

        .round-show-container {
            display: block;
        }

        .link-edit-container {
            font-size: 12px;
            display: none;
        }

        .name-edit-container {
            display: none;
            align-items: center;
        }

        .round-edit-container {
            display: none;
        }

        .link-input {
            width: 250px;
        }

        .team-input {
            width: 50px;
        }

        .players-out-input {
            width: 200px;
        }

        .name-input {
            width: 350px;
            font-size: 32px;
            font-weight: bold;
        }
        
        .league-table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #3498db;
        }
        
        .league-table th, .league-table td {
            padding: 5px 5px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        .league-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 14px;
            border: 1px solid #1a2530;
        }
        
        .league-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .league-table tr:hover {
            background-color: #d4e6f1;
        }
        
        .round-cell {
            text-align: left;
            background-color: #d6eaf8;
            border-right: 2px solid #3498db !important;
            padding: 5px 5px;
            line-height: 1.4;
            white-space: nowrap;
        }
        
        .round-number {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 15px;
        }
        
        .match {
            margin-bottom: 4px;
        }
        
        .team {
            display: inline-block;
            background-color: #f8f9fa;
            padding: 1px 6px;
            border-radius: 3px;
            margin: 1px;
            border: 1px solid #bdc3c7;
            font-size: 13px;
        }
        
        .vs {
            font-weight: bold;
            color: #34495e;
            font-size: 12px;
        }
        
        .players-out {
            margin-top: 5px;
            font-size: 11px;
            color: #34495e;
            font-weight: 500;
        }
        
        .players-out-label {
            font-weight: bold;
        }
        
        .footer {
            margin-top: 20px;
            text-align: center;
        }
        
        .footer a {
            display: inline-block;
            margin: 0 10px;
            padding: 8px 16px;
            background-color: #2c3e50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .footer a:hover {
            background-color: #1a2530;
        }
        
        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            
            .league-table {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .league-table th, .league-table td {
                border: 1px solid #000;
            }
            
            .footer {
                display: none;
            }
            
            .league-table th {
                background-color: #d6eaf8 !important;
                color: #000 !important;
                border: 1px solid #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .round-cell {
                background-color: #f2f2f2 !important;
                border-right: 2px solid #000 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            .team {
                border: 1px solid #000;
            }
        }
    
        {% if league.scoring_system.value != 'none' %}
            {% include 'templates/_ranking_styles.css' %}
        {% endif %}

        {% include 'templates/_auth.css' %}
    </style>
    <script>
        function printPage() {
            // Force landscape printing
            var style = document.createElement('style');
            style.type = 'text/css';
            style.media = 'print';
            style.innerHTML = '@page { size: landscape; }';
            document.head.appendChild(style);

            window.print();
        }
        
        // Store teammate relationships for each player in each round
        const teammateMap = {};
        
        document.addEventListener('DOMContentLoaded', function() {
            initTeammateMap();
            addScoreEventListeners();
        });
        
        var initTeammateMap = function() {
            // Create a mapping of player names to their indices
            const playerIndices = {};
            {% for player in league.players %}
                playerIndices["{{ player }}"] = {{ loop.index }};
            {% endfor %}
            
            // Create a mapping of teammates for each round
            {% for round in league.schedule %}
                teammateMap["{{ round.number }}"] = {};
                {% for match in round.matches %}
                    // Team 1
                    teammateMap["{{ round.number }}"]["{{ match.players[0].name }}"] = {
                        teammate: "{{ match.players[1].name }}",
                        teammateIndex: playerIndices["{{ match.players[1].name }}"]
                    };
                    teammateMap["{{ round.number }}"]["{{ match.players[1].name }}"] = {
                        teammate: "{{ match.players[0].name }}",
                        teammateIndex: playerIndices["{{ match.players[0].name }}"]
                    };
                    
                    // Team 2
                    teammateMap["{{ round.number }}"]["{{ match.players[2].name }}"] = {
                        teammate: "{{ match.players[3].name }}",
                        teammateIndex: playerIndices["{{ match.players[3].name }}"]
                    };
                    teammateMap["{{ round.number }}"]["{{ match.players[3].name }}"] = {
                        teammate: "{{ match.players[2].name }}",
                        teammateIndex: playerIndices["{{ match.players[2].name }}"]
                    };
                {% endfor %}
            {% endfor %}
        }
        
        var addScoreEventListeners = function() {
            // Add event listeners to all score inputs and selects
            {% for round in league.schedule %}
                {% for player in league.players %}
                    {% if player.name not in round.players_out|map(attribute='name')|list %}
                        const inputId{{ round.number }}_{{ loop.index }} = "player_score_round{{ round.number }}_player{{ loop.index }}";
                        const inputElement{{ round.number }}_{{ loop.index }} = document.getElementById(inputId{{ round.number }}_{{ loop.index }});
                        if (inputElement{{ round.number }}_{{ loop.index }}) {
                            // For number inputs (score system)
                            if (inputElement{{ round.number }}_{{ loop.index }}.type === 'number') {
                                inputElement{{ round.number }}_{{ loop.index }}.addEventListener('input', function() {
                                    syncTeammateScore("{{ round.number }}", "{{ player }}", this.value);
                                });
                            }
                            // For select elements (w/l system)
                            else if (inputElement{{ round.number }}_{{ loop.index }}.tagName === 'SELECT') {
                                inputElement{{ round.number }}_{{ loop.index }}.addEventListener('change', function() {
                                    syncTeammateScore("{{ round.number }}", "{{ player }}", this.value);
                                });
                            }
                        }
                    {% endif %}
                {% endfor %}
            {% endfor %}
        }
        
        var syncTeammateScore = function(roundNumber, playerName, value) {
            // Check if this player has a teammate in this round
            if (teammateMap[roundNumber] && teammateMap[roundNumber][playerName]) {
                const teammateInfo = teammateMap[roundNumber][playerName];
                const teammateInputId = `player_score_round${roundNumber}_player${teammateInfo.teammateIndex}`;
                const teammateInput = document.getElementById(teammateInputId);
                
                if (teammateInput) {
                    // Update the teammate's input with the same value
                    teammateInput.value = value;
                    
                    // If it's a select element, need to trigger change event for any dependent logic
                    if (teammateInput.tagName === 'SELECT') {
                        const event = new Event('change', { bubbles: true });
                        teammateInput.dispatchEvent(event);
                    }
                }
            }
        }

        var copyLink = function(link) {
            navigator.clipboard.writeText(link);
            return false;
        }

        var editLink = function() {
            document.getElementsByClassName("link-show-container")[0].style.display = "none";
            document.getElementsByClassName("link-edit-container")[0].style.display = "block";
            document.getElementById("new_league_id").focus();
            return false;
        }

        var cancelEditLink = function() {
            document.getElementsByClassName("link-edit-container")[0].style.display = "none";
            document.getElementsByClassName("link-show-container")[0].style.display = "block";
            return false;
        }

        var saveLink = function() {
            if ((document.getElementById("new_league_id").value != document.getElementById("original_league_id").value) &&
                    (document.getElementById("new_league_id").value.length > 0))  
                {
                var new_league_id = document.getElementById("new_league_id").value;
                // Replace spaces and underscores with dashes
                new_league_id = new_league_id.replace(/[\s_]/g, '-');
                // Replace multiple dashes with a single dash
                new_league_id = new_league_id.replace(/-+/g, '-');
                // Replace dashes at the beginning and end with an empty string
                new_league_id = new_league_id.replace(/^-+|-+$/g, '');
                // Replace any non-alphanumeric characters (besides dashes) with an empty string
                new_league_id = new_league_id.replace(/[^a-zA-Z0-9-]/g, '');
                document.getElementById("new_league_id").value = new_league_id;
                document.getElementById("update_league_id").value = "1";
                document.getElementById("league_form").submit();
                return true;
            }
            document.getElementsByClassName("link-edit-container")[0].style.display = "none";
            document.getElementsByClassName("link-show-container")[0].style.display = "block";
            return false;
        }

        var editName = function() {
            document.getElementsByClassName("name-show-container")[0].style.display = "none";
            document.getElementsByClassName("name-edit-container")[0].style.display = "block";
            document.getElementById("new_league_name").focus();
            return false;
        }

        var cancelEditName = function() {
            document.getElementsByClassName("name-edit-container")[0].style.display = "none";
            document.getElementsByClassName("name-show-container")[0].style.display = "block";
            return false;
        }

        var saveName = function() {
            if ((document.getElementById("new_league_name").value != document.getElementById("original_league_name").value) &&
                    (document.getElementById("new_league_name").value.length > 0))  
                {
                var new_league_name = document.getElementById("new_league_name").value;
                document.getElementById("new_league_name").value = new_league_name;
                document.getElementById("update_league_name").value = "1";
                document.getElementById("league_form").submit();
                return true;
            }
            document.getElementsByClassName("name-edit-container")[0].style.display = "none";
            document.getElementsByClassName("name-show-container")[0].style.display = "block";
            return false;
        }

        var editPlayers = function() {
            for (var i = 0; i < document.getElementsByClassName("round-show-container").length; i++) {
                document.getElementsByClassName("round-show-container")[i].style.display = "none";
                document.getElementsByClassName("round-edit-container")[i].style.display = "block";
            }
            document.getElementById("edit-players").style.visibility = "hidden";
            document.getElementById("edit-save-players").style.visibility = "visible";
            document.getElementById("edit-cancel-players").style.visibility = "visible";
            return false;
        }

        var savePlayers = function() {
            // traverse all inputs to ensure they are 
            var all_new_players = [];
            var all_original_players = [];
            for (var i = 1; i <= document.getElementsByClassName("round-show-container").length; i++) {
                var number_of_matches = document.getElementsByName("round-number"+i+"-matches")[0].value;
                for (var j = 1; j <= number_of_matches; j++) {
                    var player1 = document.getElementsByName("player-name-round"+i+"-match"+j+"-player1")[0].value;
                    var player2 = document.getElementsByName("player-name-round"+i+"-match"+j+"-player2")[0].value;
                    var player3 = document.getElementsByName("player-name-round"+i+"-match"+j+"-player3")[0].value;
                    var player4 = document.getElementsByName("player-name-round"+i+"-match"+j+"-player4")[0].value;
                    var original_player1 = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player1")[0].value;
                    var original_player2 = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player2")[0].value;
                    var original_player3 = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player3")[0].value;
                    var original_player4 = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player4")[0].value;
                    if ((player1 == "") || (player2 == "") ||  (player3 == "") || (player4 == "")) {
                        alert("Please fill in all player names for *round " + i + " match " + j + "*.");
                        return false;
                    }
                    if ((player1.indexOf(",") != -1) || (player2.indexOf(",") != -1) || (player3.indexOf(",") != -1) || (player4.indexOf(",") != -1)) {
                        alert("Player names cannot contain commas - check your entries for *round " + i + " match " + j + "*.");
                        return false;
                    }
                    if (all_new_players.indexOf(player1) == -1) {  all_new_players.push(player1); }
                    if (all_new_players.indexOf(player2) == -1) { all_new_players.push(player2); }
                    if (all_new_players.indexOf(player3) == -1) { all_new_players.push(player3); }
                    if (all_new_players.indexOf(player4) == -1) { all_new_players.push(player4); }
                    if (all_original_players.indexOf(original_player1) == -1) { all_original_players.push(original_player1); }
                    if (all_original_players.indexOf(original_player2) == -1) { all_original_players.push(original_player2); }
                    if (all_original_players.indexOf(original_player3) == -1) { all_original_players.push(original_player3); }
                    if (all_original_players.indexOf(original_player4) == -1) { all_original_players.push(original_player4); }
                }
                if (document.getElementsByName("players-out-round"+i)[0]) {
                    var players_out = document.getElementsByName("players-out-round"+i)[0].value;
                    var original_players_out = document.getElementsByName("original-players-out-round"+i)[0].value;
                    if (players_out == "") {
                        alert("Please fill in the players *out* for round " + i + ".");
                        return false;
                    }
                }
            }
            if (all_new_players.sort().join(",") != all_original_players.sort().join(",")) {
                var added_players = all_new_players.filter(player => all_original_players.indexOf(player) === -1);
                var removed_players = all_original_players.filter(player => all_new_players.indexOf(player) === -1);
                var message = "The changes look good but the number of players and/or the players have changed:\n";
                if (added_players.length > 0) {
                    message += "\n- Added players: " + added_players.join(", ");
                }
                if (removed_players.length > 0) {
                    message += "\n- Removed players: " + removed_players.join(", ");
                }
                message += "\n\nDo you want to proceed?";
                if (confirm(message) != true) {
                    cancelEditPlayers();
                    return false;
                }
            }
            document.getElementById("update_player_names").value = "1";
            document.getElementById("league_form").submit();
            return true;
        }

        var cancelEditPlayers = function() {            
            //reset all inputs to their original values
            for (var i = 1; i <= document.getElementsByClassName("round-show-container").length; i++) {
                var number_of_matches = document.getElementsByName("round-number"+i+"-matches")[0].value;
                for (var j = 1; j <= number_of_matches; j++) {
                    document.getElementsByName("player-name-round"+i+"-match"+j+"-player1")[0].value = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player1")[0].value;
                    document.getElementsByName("player-name-round"+i+"-match"+j+"-player2")[0].value = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player2")[0].value;
                    document.getElementsByName("player-name-round"+i+"-match"+j+"-player3")[0].value = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player3")[0].value;
                    document.getElementsByName("player-name-round"+i+"-match"+j+"-player4")[0].value = document.getElementsByName("original-player-name-round"+i+"-match"+j+"-player4")[0].value;
                    if (document.getElementsByName("players-out-round"+i)[0]) {
                        document.getElementsByName("players-out-round"+i)[0].value = document.getElementsByName("original-players-out-round"+i)[0].value;
                    }
                }
            }
            // reset the display of the round show and edit containers
            for (var i = 0; i < document.getElementsByClassName("round-show-container").length; i++) {
                document.getElementsByClassName("round-show-container")[i].style.display = "block";
                document.getElementsByClassName("round-edit-container")[i].style.display = "none";
            }
            document.getElementById("edit-save-players").style.visibility = "hidden";
            document.getElementById("edit-cancel-players").style.visibility = "hidden";
            document.getElementById("edit-players").style.visibility = "visible";
            return false;
        }

        {% include 'templates/_auth.js' %}
    </script>
</head>
<body>
    {% include 'templates/_auth.html' %}
    <form id="league_form" name="league_form" action="/save_league" method="post">
    <input type="hidden" name="league_id" value="{{ league.id }}">
    <div class="container">
        <h1>
            {% if league.name %}
                <div class="name-show-container">{{ league.name }} (created on {{ league.date_created }})
                {% if (league.owner and league.owner.email == user.email) or not league.owner %}
                    <button id="edit-name" class="small-button" onclick="return editName()">Edit&nbsp;name&nbsp;‚úé</button>
                {% endif %}
                </div>  
            {% else %}
                <div class="name-show-container">League created on {{ league.date_created }}
                {% if (league.owner and league.owner.email == user.email) or not league.owner %}
                    <button id="edit-name" class="small-button" onclick="return editName()">Edit&nbsp;name&nbsp;‚úé</button>
                {% endif %}
                </div>  
            {% endif %}
            <div class="name-edit-container">
                <input type="text" id="new_league_name" name="new_league_name" class="name-input" value="{{ league.name }}">
                <input type="hidden" id="original_league_name" name="original_league_name" value="{{ league.name }}">
                <input type="hidden" id="update_league_name" name="update_league_name" value="">
                <button class="small-button" onclick="return saveName()">Save&nbsp;üíæ</button>
                <button class="small-button" onclick="return cancelEditName()">Cancel&nbsp;‚ùå</button>
            </div>
            
        </h1>
        {% if league.owner %}
            <p><i><b>Private league</b> (created by: <u>{{ league.owner.email }}</u>)</i></p>
        {% else %}
            <p><i><b>Public league</b> (anyone with the link can view and edit)</i></p>
        {% endif %}
        <p>
            <div class="link-container">
                <b>Link:</b> 
                <div class="link-show-container"><a href="http://{{ domain_name }}/league/{% if league.short_link %}{{ league.short_link }}{% else %}{{ league.id }}{% endif %}">https://{{ domain_name }}/league/{% if league.short_link %}{{ league.short_link }}{% else %}{{ league.id }}{% endif %}</a></div>
                <div class="link-edit-container">http://{{ domain_name }}/league/<input type="text" id="new_league_id" name="new_league_id" class="link-input" value="{% if league.short_link %}{{ league.short_link }}{% else %}{{ league.id }}{% endif %}"><input type="hidden" id="original_league_id" name="original_league_id" value="{% if league.short_link %}{{ league.short_link }}{% else %}{{ league.id }}{% endif %}"><input type="hidden" id="update_league_id" name="update_league_id" value=""> <button class="small-button" onclick="return saveLink()">Save üíæ</button> <button class="small-button" onclick="return cancelEditLink()">Cancel ‚ùå</button></div>
                &nbsp;&nbsp;
                <button id="copy-link" class="small-button" onclick="return copyLink('http://{{ domain_name }}/league/{% if league.short_link %}{{ league.short_link }}{% else %}{{ league.id }}{% endif %}');">Copy&nbsp;üîó</button>
                {% if league.owner and league.owner.email == user.email %}
                    <button id="edit-link" class="small-button" onclick="return editLink();">Edit&nbsp;link&nbsp;‚úé</button>
                {% endif %}
            </div>
        </p>
        <div style="width: 100%; overflow-x: auto;">
            <table class="league-table">
                <thead>
                    <tr>
                        <th style="width: 20%; white-space: nowrap;" rowspan="2">
                            Rounds{% if (league.owner and league.owner.email == user.email) or not league.owner %}&nbsp;&nbsp;<button id="edit-players" class="small-button" onclick="return editPlayers();">Edit&nbsp;players&nbsp;‚úé</button><br>{% endif %}
                            <button id="edit-save-players" class="small-button" onclick="return savePlayers()">Save&nbsp;üíæ</button>&nbsp;&nbsp;<button id="edit-cancel-players" class="small-button" onclick="return cancelEditPlayers()">Cancel&nbsp;‚ùå</button>
                            <input type="hidden" name="update_player_names" id="update_player_names" value="">
                        </th>
                        <th style="width: 80%; white-space: nowrap;" colspan="{{ league.players|length }}">Player Scores</th>
                    </tr>
                    <tr>
                        {% for player in league.players %}
                            <th style="width: {{ width }}%; white-space: nowrap;">{{ player }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for round in league.schedule %}
                        <tr>
                            <td class="round-cell">
                                <div class="round-show-container">
                                    <div class="round-number">Round {{ round.number }}</div>
                                    {% for match in round.matches %}
                                        <div class="match">
                                            <span class="team">{{ match.players[0].name }}/{{ match.players[1].name }}</span>
                                            <span class="vs">vs</span>
                                            <span class="team">{{ match.players[2].name }}/{{ match.players[3].name }}</span>
                                        </div>
                                    {% endfor %}
                                    {% if round.players_out %}
                                        <div class="players-out">
                                            <span class="players-out-label">Out:</span> {{ round.players_out|join(', ') }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="round-edit-container">
                                    <div class="round-number">Round {{ round.number }}</div>
                                    <input type="hidden" name="round-number{{ round.number }}-matches" value="{{ round.matches|length }}">
                                    {% for match in round.matches %}
                                        <div class="match">
                                            <span class="team"><input class="team-input" type="text" name="player-name-round{{ round.number }}-match{{ loop.index }}-player1" value="{{ match.players[0].name }}">/<input class="team-input" type="text" name="player-name-round{{ round.number }}-match{{ loop.index }}-player2" value="{{ match.players[1].name }}"></span>
                                            <span class="vs">vs</span>
                                            <span class="team"><input class="team-input" type="text" name="player-name-round{{ round.number }}-match{{ loop.index }}-player3" value="{{ match.players[2].name }}">/<input class="team-input" type="text" name="player-name-round{{ round.number }}-match{{ loop.index }}-player4" value="{{ match.players[3].name }}"></span>
                                            <input type="hidden" name="original-player-name-round{{ round.number }}-match{{ loop.index }}-player1" value="{{ match.players[0].name }}">
                                            <input type="hidden" name="original-player-name-round{{ round.number }}-match{{ loop.index }}-player2" value="{{ match.players[1].name }}">
                                            <input type="hidden" name="original-player-name-round{{ round.number }}-match{{ loop.index }}-player3" value="{{ match.players[2].name }}">
                                            <input type="hidden" name="original-player-name-round{{ round.number }}-match{{ loop.index }}-player4" value="{{ match.players[3].name }}">
                                        </div>
                                    {% endfor %}
                                    {% if round.players_out %}
                                        <div class="players-out">
                                            <span class="players-out-label">Out:</span> <input class="players-out-input" type="text" name="players-out-round{{ round.number }}" value="{{ round.players_out|join(', ') }}">
                                            <input type="hidden" name="original-players-out-round{{ round.number }}" value="{{ round.players_out|join(', ') }}">
                                        </div>
                                    {% endif %}
                                </div>
                            </td>
                            {% for player in league.players %}                        
                                {% set ns1 = namespace(color="") %}
                                {% set ns2 = namespace(w="") %}
                                {% set ns3 = namespace(l="") %}
                                {% set ns4 = namespace(score="") %}
                                {% for match in round.matches %}
                                    {% if player.name in [match.players[0].name, match.players[1].name] %}
                                        {% set ns4.score = match.score[0] %}
                                        {% if match.get_winner_team() == 1 %}
                                            {% set ns1.color = "#90EE90" %}
                                            {% set ns2.w = "selected" %}
                                        {% elif match.get_winner_team() == 2 %}
                                            {% set ns1.color = "#FFCCCB" %}
                                            {% set ns3.l = "selected" %}
                                        {% endif %}
                                    {% elif player.name in [match.players[2].name, match.players[3].name] %}
                                        {% set ns4.score = match.score[1] %}
                                        {% if match.get_winner_team() == 1 %}
                                            {% set ns1.color = "#FFCCCB" %}
                                            {% set ns3.l = "selected" %}
                                        {% elif match.get_winner_team() == 2 %}
                                            {% set ns1.color = "#90EE90" %}
                                            {% set ns2.w = "selected" %}
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                                {% if league.scoring_system.value == 'w_l' %}
                                    {% if player.name not in round.players_out|map(attribute='name')|list %}
                                        <td style="background-color: {{ ns1.color }};">    
                                            {% if (league.owner and league.owner.email == user.email) or not league.owner %}
                                                <select name="player_score_round{{ round.number }}_player{{ loop.index }}" id="player_score_round{{ round.number }}_player{{ loop.index }}">
                                                    <option value="0"></option>
                                                    <option value="w" {{ ns2.w }}>W</option>
                                                    <option value="l" {{ ns3.l }}>L</option>
                                                </select>
                                            {% else %}
                                                {{ ns4.score }}
                                            {% endif %}
                                        </td>
                                    {% else %}
                                        <td>x</td>
                                    {% endif %}
                                {% elif league.scoring_system.value == 'score' %}
                                    {% if player.name not in round.players_out|map(attribute='name')|list %}
                                        <td style="background-color: {{ ns1.color }};">
                                            {% if (league.owner and league.owner.email == user.email) or not league.owner %}
                                                <input type="number" name="player_score_round{{ round.number }}_player{{ loop.index }}" id="player_score_round{{ round.number }}_player{{ loop.index }}" min="0" max="100" step="1" value="{{ ns4.score }}">
                                            {% else %}
                                                {{ ns4.score }}
                                            {% endif %}
                                        </td>
                                    {% else %}
                                        <td>x</td>
                                    {% endif %}
                                {% else %}
                                    <td></td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div id="footer" class="footer">
            <a href="#" onclick="printPage()">Print</a>
            {% if league.scoring_system.value != 'none' and ((league.owner and league.owner.email == user.email) or not league.owner) %}<a href="#" onclick="document.getElementById('league_form').submit()">Save</a>{% endif %}
            <a href="/">Home</a>
        </div>
    </div>
    </form>
    {% if league.scoring_system.value != 'none' %}
        {% include 'templates/_ranking.html' %}
    {% endif %}
</body>
</html>